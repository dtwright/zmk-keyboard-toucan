#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>
#include "layer-defs.h"

/ {
       behaviors {
            tp: tap_mods {
                compatible = "zmk,behavior-hold-tap";
                label = "TAP_MODS";
                tapping-term-ms = <225>;
                quick-tap-ms = <190>;
                flavor = "balanced";
                #binding-cells = <2>;
                bindings = <&kp>, <&kp>;
            };

            tl: layer_tap {
                compatible = "zmk,behavior-hold-tap";
                label = "LAYER_TAP";
                tapping-term-ms = <225>;
                quick-tap-ms = <190>;
                flavor = "hold-preferred";
                #binding-cells = <2>;
                bindings = <&mo>, <&kp>;
            };
        };    

        conditional_layers {
        compatible = "zmk,conditional-layers";
        tri_layer {
            if-layers = <LOWER RAISE>;
            then-layer = <ADJUST>;
        };

    };

    keymap {
        compatible = "zmk,keymap";

        base {
            display-name = "BASE";
            bindings = <
   &kp ESC   &kp Q &kp W &kp E &kp R &kp T   &kp Y &kp U  &kp I     &kp O   &kp P    &kp SQT
   &tp LGUI TAB   &kp A &kp S &tp LCTRL D &tp LALT F &kp G   &kp H &kp J  &kp K     &kp L   &kp SEMI &kp RCTRL
   &tp LSHFT LPAR &kp Z &kp X &kp C &kp V &kp B   &kp N &kp M  &kp COMMA &kp DOT &kp FSLH &tp RSHFT RPAR
                    &kp LALT &mo RAISE &tl MOUSE RET   &tl MOUSE SPACE &tl LOWER BSPC &kp LALT
            >;
        };

        pc {
            display-name = "PC";
            bindings = <
    &trans        &trans &trans &trans  &trans &trans &trans &trans &trans &trans &trans &kp SQT
    &mt LCTRL TAB &trans &trans &trans  &trans &trans &trans &trans &trans &trans &trans &trans
    &trans        &trans &trans &trans  &trans &trans &trans &trans &trans &trans &trans &trans
                                &kp LGUI  &trans &trans &trans &trans &trans
            >;
        };

        lower {
            display-name = "LWR";
            bindings = <
   &trans    &kp N1       &kp N2       &kp N3       &kp N4       &kp N5            &kp N6   &kp N7   &kp N8 &kp N9    &kp N0 &kp BSLH 
   &kp GRAVE &trans  &trans  &trans  &trans &trans      &trans &kp MINUS &kp EQUAL &trans &trans &trans
   &tp LSHIFT LBKT  &trans       &trans       &trans       &trans       &kp LBKT            &kp RBKT   &trans   &trans &trans &trans  &tp RSHIFT RBKT
                                        &kp LGUI     &trans       &kp SPACE         &kp RET &trans &kp RALT
            >;
        };

        raise {
            display-name = "RSE";
            bindings = <
    &trans  &kp N1       &kp N2       &kp N3       &kp N4       &kp N5            &kp N6   &kp N7   &kp N8 &kp N9    &kp N0 &kp PIPE
    &kp TILDE &trans    &trans  &trans &trans &trans      &trans &kp UNDER &kp PLUS &kp LBKT        &kp RBKT &kp PIPE
    &tp LSHIFT LBRC &trans    &trans  &trans     &trans     &kp LBRC      &kp RBRC    &trans    &trans          &trans   &trans &tp RSHIFT RBRC
                                   &kp LGUI &trans &kp SPACE   &kp RET &trans &kp RALT
            >;
        };

        adjust {
                display-name = "ADJ";
                bindings = <
    &trans  &kp C_PREV  &kp C_PP  &kp C_NEXT   &none   &none   &out OUT_TOG &kp AMPS  &kp KP_MULTIPLY &kp LPAR &kp RPAR &tog PC
    &bt BT_CLR &bt BT_SEL 0 &bt BT_SEL 1 &bt BT_SEL 2 &bt BT_SEL 3 &bt BT_SEL 4     &trans &kp C_VOLUME_DOWN &kp C_VOLUME_UP &trans &trans &trans 
    &kp LSHFT &trans    &trans  &trans     &trans     &trans      &trans    &trans    &trans          &trans   &kp BSLH &kp TILDE
                                   &kp LGUI &trans &kp SPACE   &kp RET &trans &kp RALT
                        >;
        };

        mouse {
               display-name = "MSE";
               bindings = <
    &kp ESC &none &none &none &none &none &none &none &none &none &none &none 
    &none &none &none &none &none &none &kp LEFT &kp DOWN  &kp UP    &kp RIGHT &none &none
    &none &none &none &none &none &none &kp HOME &kp PG_DN &kp PG_UP &kp END   &none &none
    &none &none &none                                                &none     &none &none 
                        >;
        };

        extra_3 {
                status = "reserved";
        };
    };
};
